<div class="product-management-container">
  <div class="header-section">
    <div class="header-left">
      <h3 class="page-title">Quản lý sản phẩm</h3>
      <span class="product-count">Tổng: {{ products?.length || 0 }} sản phẩm</span>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="exportExcel()">
        <i class="pi pi-download"></i>
        <span class="btn-text">Xuất Excel</span>
      </button>
      <button class="btn btn-primary" (click)="openAddProductDialog()">
        <i class="pi pi-plus"></i>
        Thêm sản phẩm
      </button>
    </div>
  </div>

  <div class="search-filter-section">
    <div class="search-box">
      <i class="pi pi-search search-icon"></i>
      <input
        type="text"
        class="search-input"
        placeholder="Tìm kiếm theo tên, SKU, barcode..."
        [(ngModel)]="searchText"
        (input)="onSearch()"
      />
      <i *ngIf="searchText" class="pi pi-times clear-icon" (click)="clearSearch()"></i>
    </div>
    <div class="filter-controls">
      <p-select
        [options]="filterCategories"
        [(ngModel)]="selectedFilterCategory"
        optionLabel="name"
        placeholder="Tất cả phân loại"
        class="filter-select"
        (onChange)="onFilterChange()"
        [showClear]="true"
      />
      <p-select
        [options]="stockFilters"
        [(ngModel)]="selectedStockFilter"
        optionLabel="name"
        placeholder="Tình trạng kho"
        class="filter-select"
        (onChange)="onFilterChange()"
        [showClear]="true"
      />
    </div>
  </div>

  <div class="table-container">
    <p-table
      [value]="filteredProducts"
      [rows]="10"
      [paginator]="true"
      [tableStyle]="{ 'min-width': '100%' }"
      [rowsPerPageOptions]="[10, 25, 50]"
      currentPageReportTemplate="Hiển thị {first} - {last} trong tổng {totalRecords} sản phẩm"
      [showCurrentPageReport]="true"
      [loading]="loading"
      responsiveLayout="scroll"
    >
      <ng-template #header>
        <tr>
          <th style="width: 50px">#</th>
          <th style="width: 80px">Ảnh</th>
          <th>Tên sản phẩm</th>
          <th style="width: 120px">SKU</th>
          <th style="width: 150px">Phân loại</th>
          <th style="width: 130px" class="text-right">Giá nhập</th>
          <th style="width: 130px" class="text-right">Giá bán</th>
          <th style="width: 100px">Đơn vị</th>
          <th style="width: 100px" class="text-center">Tồn kho</th>
          <th style="width: 150px" class="text-center">Thao tác</th>
        </tr>
      </ng-template>
      <ng-template #body let-product let-rowIndex="rowIndex">
        <tr [class.low-stock]="product.stock_quantity <= 10">
          <td>{{ rowIndex + 1 }}</td>
          <td>
            <div class="product-image">
              <img [src]="product.image || ''" (error)="onImageError($event)" />
            </div>
          </td>
          <td>
            <div class="product-name-cell">
              <span class="product-name">{{ product.name }}</span>
              <span *ngIf="product.stock_quantity <= 10" class="stock-warning">
                <i class="pi pi-exclamation-triangle"></i>
                Sắp hết hàng
              </span>
            </div>
          </td>
          <td>
            <span class="sku-badge">{{ product.sku }}</span>
          </td>
          <td>
            <span class="category-tag text-hidden">{{ product.name_category }}</span>
          </td>
          <td class="text-right">
            <span class="price-text">{{ product.cost_price | number : '1.0-0' }}</span>
          </td>
          <td class="text-right">
            <span class="price-text price-sell">{{ product.price | number : '1.0-0' }}</span>
          </td>
          <td>{{ product.unit }}</td>
          <td class="text-center">
            <span class="stock-badge" [class.stock-low]="product.stock_quantity <= 10">
              {{ product.stock_quantity }}
            </span>
          </td>
          <td class="text-center">
            <div class="action-buttons">
              <button class="btn-action btn-edit" (click)="editProduct(product)" title="Sửa">
                <i class="pi pi-pencil"></i>
              </button>
              <button class="btn-action btn-delete" (click)="confirmDelete(product)" title="Xóa">
                <i class="pi pi-trash"></i>
              </button>
              <button class="btn-action btn-info" (click)="viewDetail(product)" title="Chi tiết">
                <i class="pi pi-info-circle"></i>
              </button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template #emptymessage>
        <tr>
          <td colspan="10" class="empty-message">
            <div class="empty-state">
              <i class="pi pi-inbox empty-icon"></i>
              <p>Không tìm thấy sản phẩm nào</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-toast />
</div>
