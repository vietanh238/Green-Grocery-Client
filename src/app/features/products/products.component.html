<div class="d-flex justify-content-between p-3 align-items-center">
  <h3 style="color: green; font-weight: bold">Quản lý sản phẩm</h3>
  <button class="btn btn-success" (click)="showDialog()">Thêm sản phẩm</button>
</div>
<p-dialog
  header="Thêm sản phẩm mới"
  [modal]="true"
  [(visible)]="visible"
  [style]="{ width: '25rem' }"
  draggable="false"
  appendTo="body"
>
  <div class="d-flex flex-column">
    <label for="productName" class="label">Tên sản phẩm <span class="require-input">*</span></label>
    <input
      pInputText
      id="productName"
      class="flex-auto"
      autocomplete="off"
      placeholder="Nhập tên sản phẩm"
      [(ngModel)]="productName"
      (blur)="blurValidate($event, 'productName')"
      maxlength="255"
    />
  </div>
  <div class="d-flex flex-column mt-3">
    <label for="sku" class="label">SKU<span class="require-input">*</span></label>
    <input
      pInputText
      id="sku"
      class="flex-auto"
      autocomplete="off"
      placeholder="Nhập mã SKU"
      [(ngModel)]="sku"
      (blur)="blurValidate($event, 'sku')"
      maxlength="64"
    />
  </div>
  <div class="d-flex mt-3 row">
    <div class="col-6 col-sm-6">
      <label for="costPrice" class="label">Giá nhập<span class="require-input">*</span></label>
      <input
        pInputText
        id="costPrice"
        class="flex-auto w-100"
        autocomplete="off"
        placeholder="0"
        (input)="inputPrice($event, 'costPrice')"
        (blur)="blurPrice($event, 'costPrice'); blurValidate($event, 'costPrice')"
        (focus)="focusPrice($event, 'costPrice')"
        (keydown)="keydownPrice($event)"
        (paste)="pastePrice($event, 'costPrice')"
      />
    </div>
    <div class="col-6 col-sm-6">
      <label for="price" class="label">Giá bán<span class="require-input">*</span></label>
      <input
        pInputText
        id="price"
        class="flex-auto w-100"
        autocomplete="off"
        placeholder="0"
        (input)="inputPrice($event, 'price')"
        (blur)="blurPrice($event, 'price'); blurValidate($event, 'price')"
        (focus)="focusPrice($event, 'price')"
        (keydown)="keydownPrice($event)"
        (paste)="pastePrice($event, 'price')"
      />
    </div>
  </div>
  <div class="d-flex mt-3 row">
    <div class="col-6 col-sm-6">
      <label for="quantity" class="label">Số lượng<span class="require-input">*</span></label>
      <input
        pInputText
        id="quantity"
        class="flex-auto w-100"
        autocomplete="off"
        placeholder="0"
        type="number"
        (blur)="blurValidate($event, 'quantity')"
      />
    </div>
    <div class="col-6 col-sm-6">
      <label for="unit" class="label">Đơn vị<span class="require-input">*</span></label>
      <p-select
        id="unit"
        [options]="lstUnit"
        [(ngModel)]="unitSld"
        optionLabel="name"
        class="w-100"
        appendTo="body"
        [filter]="true"
        (onChange)="onSelectChange($event, 'unit')"
      />
    </div>
  </div>
  <div class="d-flex mt-3 row">
    <div class="col-6 col-sm-6">
      <label for="category" class="label">Phân loại mới<span class="require-input">*</span></label>
      <input
        pInputText
        id="category"
        class="flex-auto w-100"
        autocomplete="off"
        [(ngModel)]="category"
        placeholder="Nhập tên loại"
        (blur)="blurValidate($event, 'category')"
        maxlength="255"
      />
    </div>
    <div class="col-6 col-sm-6">
      <label for="categorySld" class="label">Phân loại đã có</label>
      <p-select
        id="categorySld"
        [options]="lstCategory"
        [(ngModel)]="categorySld"
        optionLabel="name"
        placeholder="Chọn"
        class="w-100"
        appendTo="body"
        [filter]="true"
        filterBy="name"
        (onChange)="changeCategory()"
      />
    </div>
  </div>

  <div class="d-flex flex-column mt-3">
    <label for="barCode" class="label">Barcode<span class="require-input">*</span></label>
    <div class="d-flex justify-content-between gap-1">
      <input
        pInputText
        id="barCode"
        class="flex-auto w-100"
        autocomplete="off"
        [(ngModel)]="barCode"
        (blur)="blurValidate($event, 'barCode')"
        maxlength="64"
      />
      <div>
        <p-button icon="pi pi-qrcode" severity="secondary" (click)="openScanner()" />
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-between mt-4">
    <p-button label="Hủy" severity="secondary" (click)="visible = false" />
    <p-button label="Lưu" (click)="save()" />
  </div>
</p-dialog>
<p-toast />
<div class="mt-2" style="margin: 0 auto">
  <p-table [rows]="5" [value]="products" [tableStyle]="{ 'min-width': '50rem' }" [paginator]="true">
    <ng-template #header>
      <tr>
        <th>Tên</th>
        <th>Sku</th>
        <th>Loại</th>
        <th>Giá</th>
        <th>Đơn vị</th>
        <th>Số lượng</th>
      </tr>
    </ng-template>
    <ng-template #body let-product>
      <tr>
        <td>{{ product.name }}</td>
        <td>{{ product.sku }}</td>
        <td>{{ product.name_category }}</td>
        <td>{{ product.price | number : '1.0-0' }} VND</td>
        <td>{{ product.unit }}</td>
        <td>{{ product.stock_quantity }}</td>
      </tr>
    </ng-template>
  </p-table>
</div>
