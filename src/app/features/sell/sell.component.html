<div class="sell-container">
  <!-- Search Section -->
  <div class="search-section">
    <div class="search-row">
      <div class="search-input-wrapper">
        <i class="pi pi-search search-icon"></i>
        <input
          type="text"
          class="search-input"
          placeholder="Tìm kiếm sản phẩm theo tên, SKU, barcode..."
          (input)="filterProducts($event)"
          [(ngModel)]="searchTerm"
          #searchInput
        />
      </div>
      <button class="scan-button" (click)="openScanner()">
        <i class="pi pi-camera"></i>
        Quét mã
      </button>
      <button class="manual-order-btn" (click)="addManualOrder()">
        <i class="pi pi-plus"></i>
        Thêm thủ công
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Products Section -->
    <div class="products-section">
      <div class="products-header">
        <h3 class="products-title">
          <i class="pi pi-shopping-bag"></i>
          Sản phẩm
          <span class="products-count">{{ productsCount }}</span>
        </h3>
        <div class="products-actions">
          <button class="refresh-btn" (click)="loadProducts()" [disabled]="loading">
            <i class="pi pi-refresh" [class.pi-spin]="loading"></i>
          </button>
        </div>
      </div>

      <div class="products-grid" *ngIf="!loading; else skeleton">
        <div *ngIf="isProductNotFound" class="product-not-found">
          <i class="pi pi-search" style="font-size: 2rem; margin-bottom: 1rem"></i>
          <p>Không tìm thấy sản phẩm phù hợp</p>
          <button
            class="retry-search-btn"
            (click)="searchTerm = ''; filterProducts({ target: { value: '' } })"
          >
            Hiển thị tất cả
          </button>
        </div>

        <app-card
          *ngFor="let product of filteredProducts"
          [product]="product"
          (addToCart)="handleAddToCart($event)"
        >
        </app-card>
      </div>

      <ng-template #skeleton>
        <div class="skeleton-grid">
          <p-skeleton *ngFor="let i of [1, 2, 3, 4, 5, 6]" class="skeleton-card"></p-skeleton>
        </div>
      </ng-template>
    </div>

    <!-- Cart Section -->
    <div class="cart-section">
      <div class="cart-header">
        <h3 class="cart-title">
          <i class="pi pi-shopping-cart"></i>
          Giỏ hàng
          <span class="cart-count">{{ cartItemsCount }}</span>
        </h3>
        <button class="clear-cart-btn" (click)="clearCart()" [disabled]="cartItems.length === 0">
          <i class="pi pi-trash"></i>
        </button>
      </div>

      <div class="cart-body">
        <div *ngIf="cartItems.length === 0" class="empty-cart">
          <i class="pi pi-shopping-cart"></i>
          <p>Giỏ hàng trống</p>
          <small>Thêm sản phẩm để bắt đầu bán hàng</small>
        </div>

        <div *ngIf="cartItems.length > 0" class="cart-items">
          <div *ngFor="let item of cartItems" class="cart-item">
            <div class="item-header">
              <h4 class="item-name">{{ item.name }}</h4>
              <span class="item-price">{{ formatCurrency(item.price) }}</span>
            </div>

            <div class="item-details">
              <span class="item-sku">SKU: {{ item.sku }}</span>
              <span class="item-barcode">Barcode: {{ item.bar_code }}</span>
            </div>

            <div class="item-actions">
              <div class="quantity-controls">
                <button
                  class="quantity-btn"
                  (click)="decreaseQuantity(item)"
                  [disabled]="item.quantity <= 1"
                >
                  <i class="pi pi-minus"></i>
                </button>
                <span class="quantity-value">{{ item.quantity }}</span>
                <button class="quantity-btn" (click)="increaseQuantity(item)">
                  <i class="pi pi-plus"></i>
                </button>
              </div>

              <div class="item-total">
                {{ formatCurrency(item.price * item.quantity) }}
              </div>

              <button class="delete-btn" (click)="removeItem(item)">
                <i class="pi pi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="cartItems.length > 0" class="cart-footer">
        <div class="total-section">
          <div class="total-row">
            <span class="total-label">Tổng tiền:</span>
            <span class="total-amount">{{ formatCurrency(totalAmount) }}</span>
          </div>
          <div class="total-items">{{ totalItemsCount }} sản phẩm</div>
        </div>

        <div class="payment-actions">
          <button
            class="payment-btn cash-btn"
            (click)="cashPayment()"
            [disabled]="isProcessingPayment"
          >
            <i class="pi pi-money-bill"></i>
            {{ isProcessingPayment ? 'Đang xử lý...' : 'Tiền mặt' }}
          </button>

          <button class="payment-btn qr-btn" (click)="createPaymentQR()">
            <i class="pi pi-qrcode"></i>
            QR Code
          </button>

          <button class="payment-btn debit-btn" (click)="createDebit()">
            <i class="pi pi-book"></i>
            Ghi nợ
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
