<div class="home-container">
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <h2 class="page-title">
          <i class="pi pi-home"></i>
          Dashboard
        </h2>
        <p class="page-subtitle">Tổng quan hoạt động kinh doanh hôm nay</p>
      </div>
      <div class="header-actions">
        <p-select
          [(ngModel)]="selectedPeriod"
          [options]="periodOptions"
          optionLabel="label"
          optionValue="value"
          (onChange)="onPeriodChange()"
          styleClass="period-select"
          placeholder="Chọn khoảng thời gian"
        />
        <button class="action-btn refresh-btn" (click)="refreshData()" [disabled]="loading">
          <i
            class="pi"
            [class.pi-refresh]="!loading"
            [class.pi-spin]="loading"
            [class.loading]="loading"
          ></i>
        </button>
        <button class="action-btn export-btn" (click)="exportReport()">
          <i class="pi pi-file-excel"></i>
          <span>Xuất Excel</span>
        </button>
      </div>
    </div>
  </div>

  <div class="stats-grid" *ngIf="!loading">
    <div class="stat-card revenue">
      <div class="stat-header">
        <div class="stat-icon">
          <i class="pi pi-dollar"></i>
        </div>
        <div class="stat-trend" [class.up]="revenueGrowth >= 0" [class.down]="revenueGrowth < 0">
          <i [class]="revenueGrowth >= 0 ? 'pi pi-arrow-up' : 'pi pi-arrow-down'"></i>
          <span>{{ Math.abs(revenueGrowth) }}%</span>
        </div>
      </div>
      <div class="stat-body">
        <p class="stat-label">Doanh thu</p>
        <h3 class="stat-value">{{ todayRevenue | number : '1.0-0' }} đ</h3>
        <p class="stat-compare">
          <span [class.positive]="revenueComparison >= 0" [class.negative]="revenueComparison < 0">
            {{ revenueComparison >= 0 ? '+' : '' }}{{ revenueComparison | number : '1.0-0' }} đ
          </span>
          so với {{ comparisonPeriod }}
        </p>
      </div>
    </div>

    <div class="stat-card orders">
      <div class="stat-header">
        <div class="stat-icon">
          <i class="pi pi-shopping-cart"></i>
        </div>
        <div class="stat-trend" [class.up]="orderGrowth >= 0" [class.down]="orderGrowth < 0">
          <i [class]="orderGrowth >= 0 ? 'pi pi-arrow-up' : 'pi pi-arrow-down'"></i>
          <span>{{ Math.abs(orderGrowth) }}%</span>
        </div>
      </div>
      <div class="stat-body">
        <p class="stat-label">Đơn hàng</p>
        <h3 class="stat-value">{{ todayOrders }}</h3>
        <p class="stat-compare">
          <span [class.positive]="orderComparison >= 0" [class.negative]="orderComparison < 0">
            {{ orderComparison >= 0 ? '+' : '' }}{{ orderComparison }}
          </span>
          so với {{ comparisonPeriod }}
        </p>
      </div>
    </div>

    <div class="stat-card profit">
      <div class="stat-header">
        <div class="stat-icon">
          <i class="pi pi-chart-line"></i>
        </div>
        <div class="stat-trend" [class.up]="profitGrowth >= 0" [class.down]="profitGrowth < 0">
          <i [class]="profitGrowth >= 0 ? 'pi pi-arrow-up' : 'pi pi-arrow-down'"></i>
          <span>{{ Math.abs(profitGrowth) }}%</span>
        </div>
      </div>
      <div class="stat-body">
        <p class="stat-label">Lợi nhuận</p>
        <h3 class="stat-value">{{ todayProfit | number : '1.0-0' }} đ</h3>
        <p class="stat-compare">Tỷ suất: {{ profitMargin.toFixed(1) }}%</p>
      </div>
    </div>

    <div class="stat-card customers">
      <div class="stat-header">
        <div class="stat-icon">
          <i class="pi pi-users"></i>
        </div>
        <div class="stat-trend" [class.up]="customerGrowth >= 0" [class.down]="customerGrowth < 0">
          <i [class]="customerGrowth >= 0 ? 'pi pi-arrow-up' : 'pi pi-arrow-down'"></i>
          <span>{{ Math.abs(customerGrowth) }}%</span>
        </div>
      </div>
      <div class="stat-body">
        <p class="stat-label">Khách hàng</p>
        <h3 class="stat-value">{{ todayCustomers }}</h3>
        <p class="stat-compare">Khách mới: {{ newCustomers }} người</p>
      </div>
    </div>
  </div>

  <div class="charts-wrapper" *ngIf="!loading">
    <div class="chart-card revenue-chart">
      <div class="chart-header">
        <h3 class="chart-title">
          <i class="pi pi-chart-line"></i>
          Biểu đồ doanh thu
        </h3>
      </div>
      <div class="chart-body">
        <p-chart
          type="line"
          [data]="revenueChartData"
          [options]="revenueChartOptions"
          [style]="{ position: 'relative', height: '320px', width: '100%' }"
        />
      </div>
    </div>

    <div class="chart-card category-chart">
      <div class="chart-header">
        <h3 class="chart-title">
          <i class="pi pi-chart-pie"></i>
          Doanh thu theo danh mục
        </h3>
      </div>
      <div class="chart-body">
        <p-chart
          type="doughnut"
          [data]="categoryChartData"
          [options]="pieChartOptions"
          [style]="{ position: 'relative', height: '320px' }"
        />
      </div>
    </div>
  </div>

  <div class="data-grid" *ngIf="!loading">
    <div class="data-section recent-sales">
      <div class="section-header">
        <h3 class="section-title">
          <i class="pi pi-clock"></i>
          Đơn hàng gần đây
        </h3>
        <button class="view-all-btn" (click)="viewAllSales()">
          Xem tất cả
          <i class="pi pi-arrow-right"></i>
        </button>
      </div>
      <div class="table-wrapper">
        <p-table [value]="recentSales" [rows]="5" styleClass="sales-table">
          <ng-template #header>
            <tr>
              <th style="width: 100px">Mã đơn</th>
              <th style="width: 80px">Thời gian</th>
              <th>Khách hàng</th>
              <th class="text-right" style="width: 120px">Số tiền</th>
              <th style="width: 110px">Thanh toán</th>
              <th class="text-center" style="width: 100px">Trạng thái</th>
            </tr>
          </ng-template>
          <ng-template #body let-sale>
            <tr>
              <td>
                <span class="order-id">{{ sale.order_code }}</span>
              </td>
              <td>
                <span class="time">{{ sale.created_at | date : 'HH:mm' }}</span>
              </td>
              <td>
                <span class="customer-name">{{ sale.buyer_name || 'Khách lẻ' }}</span>
              </td>
              <td class="text-right">
                <span class="amount">{{ sale.amount | number : '1.0-0' }} đ</span>
              </td>
              <td>
                <span class="payment-method">{{ getPaymentMethod(sale.status) }}</span>
              </td>
              <td class="text-center">
                <p-tag
                  [value]="getStatusLabel(sale.status)"
                  [severity]="getStatusSeverity(sale.status)"
                />
              </td>
            </tr>
          </ng-template>
          <ng-template #emptymessage>
            <tr>
              <td colspan="6" class="text-center">Không có đơn hàng</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <div class="data-section top-products">
      <div class="section-header">
        <h3 class="section-title">
          <i class="pi pi-star-fill"></i>
          Sản phẩm bán chạy
        </h3>
        <button class="view-all-btn" (click)="viewAllProducts()">
          Xem tất cả
          <i class="pi pi-arrow-right"></i>
        </button>
      </div>
      <div class="products-list">
        <div class="product-item" *ngFor="let product of topProducts; let i = index">
          <div class="product-rank" [class.top3]="i < 3">{{ i + 1 }}</div>
          <div class="product-info">
            <h4 class="product-name">{{ product.name }}</h4>
            <div class="product-stats">
              <span class="quantity">
                <i class="pi pi-box"></i>
                {{ product.quantity }} đã bán
              </span>
              <span class="revenue">{{ product.revenue | number : '1.0-0' }} đ</span>
            </div>
          </div>
        </div>
        <div class="empty-state" *ngIf="!topProducts || topProducts.length === 0">
          <p>Không có dữ liệu sản phẩm</p>
        </div>
      </div>
    </div>
  </div>

  <div class="quick-actions">
    <h3 class="section-title">
      <i class="pi pi-bolt"></i>
      Thao tác nhanh
    </h3>
    <div class="actions-grid">
      <button class="quick-action-btn" (click)="navigateTo('/page/sell')">
        <i class="pi pi-plus-circle"></i>
        <span>Tạo đơn hàng</span>
      </button>
      <button class="quick-action-btn" (click)="navigateTo('/page/products')">
        <i class="pi pi-shopping-bag"></i>
        <span>Thêm sản phẩm</span>
      </button>
      <button class="quick-action-btn" (click)="navigateTo('/page/debit')">
        <i class="pi pi-user-plus"></i>
        <span>Thêm khách hàng</span>
      </button>
      <button class="quick-action-btn" (click)="navigateTo('/page/report')">
        <i class="pi pi-file-pdf"></i>
        <span>Xem báo cáo</span>
      </button>
    </div>
  </div>

  <p-toast position="top-right" />
</div>
